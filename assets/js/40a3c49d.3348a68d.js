"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[87612],{31753:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var o=n(83117),i=(n(67294),n(3905));const r={id:"collect-fees",title:"Collecting Fees",sidebar_position:3},a=void 0,s={unversionedId:"contracts/v3/guides/providing-liquidity/collect-fees",id:"contracts/v3/guides/providing-liquidity/collect-fees",title:"Collecting Fees",description:"Collect Fees",source:"@site/docs/contracts/v3/guides/providing-liquidity/collect-fees.md",sourceDirName:"contracts/v3/guides/providing-liquidity",slug:"/contracts/v3/guides/providing-liquidity/collect-fees",permalink:"/docs/contracts/v3/guides/providing-liquidity/collect-fees",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/contracts/v3/guides/providing-liquidity/collect-fees.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"collect-fees",title:"Collecting Fees",sidebar_position:3},sidebar:"contractsSidebar",previous:{title:"Mint a New Position",permalink:"/docs/contracts/v3/guides/providing-liquidity/mint-a-position"},next:{title:"Decrease Liquidity",permalink:"/docs/contracts/v3/guides/providing-liquidity/decrease-liquidity"}},l={},c=[{value:"Collect Fees",id:"collect-fees",level:2},{value:"Sending Fees To The Calling Address",id:"sending-fees-to-the-calling-address",level:2}],d={toc:c};function u(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"collect-fees"},"Collect Fees"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Make sure to go through the ",(0,i.kt)("a",{parentName:"p",href:"/docs/contracts/v3/guides/providing-liquidity/setting-up"},"first guide")," before continuing to this section.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"For each of these liquidity interaction examples, our contract must be in possession of the liquidity position NFT. Therefore, in any example where the NFT deposit is not coded into a function, the contract is assumed to already be in possession of it."))),(0,i.kt)("p",null,"To collect the fees of an owner position, transfer the NFT from the calling address, assign the relevant variables from the NFT to local variables within our function, and pass those variables to the",(0,i.kt)("inlineCode",{parentName:"p"},"nonfungiblePositionManager")," to call ",(0,i.kt)("inlineCode",{parentName:"p"},"collect"),"."),(0,i.kt)("p",null,"This function collects all fees, sending them to the original owner of the NFT, while maintaining custody of the position NFT."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"    /// @notice Collects the fees associated with provided liquidity\n    /// @dev The contract must hold the erc721 token before it can collect fees\n    /// @param tokenId The id of the erc721 token\n    /// @return amount0 The amount of fees collected in token0\n    /// @return amount1 The amount of fees collected in token1\n    function collectAllFees(uint256 tokenId) external returns (uint256 amount0, uint256 amount1) {\n        // Caller must own the ERC721 position\n        // Call to safeTransfer will trigger `onERC721Received` which must return the selector else transfer will fail\n        nonfungiblePositionManager.safeTransferFrom(msg.sender, address(this), tokenId);\n\n        // set amount0Max and amount1Max to uint256.max to collect all fees\n        // alternatively can set recipient to msg.sender and avoid another transaction in `sendToOwner`\n        INonfungiblePositionManager.CollectParams memory params =\n            INonfungiblePositionManager.CollectParams({\n                tokenId: tokenId,\n                recipient: address(this),\n                amount0Max: type(uint128).max,\n                amount1Max: type(uint128).max\n            });\n\n        (amount0, amount1) = nonfungiblePositionManager.collect(params);\n\n        // send collected feed back to owner\n        _sendToOwner(tokenId, amount0, amount1);\n    }\n")),(0,i.kt)("h2",{id:"sending-fees-to-the-calling-address"},"Sending Fees To The Calling Address"),(0,i.kt)("p",null,"This internal helper function sends any tokens, in the form of fees or position tokens, to the owner of an NFT."),(0,i.kt)("p",null,"In ",(0,i.kt)("inlineCode",{parentName:"p"},"_sendToOwner"),", we pass the amount of fees due, previously populated in the last function, as arguments to ",(0,i.kt)("inlineCode",{parentName:"p"},"safeTransfer"),", which transfers the fees to ",(0,i.kt)("inlineCode",{parentName:"p"},"owner"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"    /// @notice Transfers funds to owner of NFT\n    /// @param tokenId The id of the erc721\n    /// @param amount0 The amount of token0\n    /// @param amount1 The amount of token1\n    function _sendToOwner(\n        uint256 tokenId,\n        uint256 amount0,\n        uint256 amount1\n    ) internal {\n        // get owner of contract\n        address owner = deposits[tokenId].owner;\n\n        address token0 = deposits[tokenId].token0;\n        address token1 = deposits[tokenId].token1;\n        // send collected fees to owner\n        TransferHelper.safeTransfer(token0, owner, amount0);\n        TransferHelper.safeTransfer(token1, owner, amount1);\n    }\n")))}u.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var o=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=o.createContext({}),c=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},d=function(e){var t=c(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(n),f=i,m=p["".concat(l,".").concat(f)]||p[f]||u[f]||r;return n?o.createElement(m,a(a({ref:t},d),{},{components:n})):o.createElement(m,a({ref:t},d))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,a=new Array(r);a[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,a[1]=s;for(var c=2;c<r;c++)a[c]=n[c];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);