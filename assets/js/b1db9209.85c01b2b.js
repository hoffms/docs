"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[637],{91179:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=a(83117),r=(a(67294),a(3905));const o={id:"flash-swaps",title:"Flash Swaps"},i=void 0,s={unversionedId:"contracts/v2/concepts/core-concepts/flash-swaps",id:"contracts/v2/concepts/core-concepts/flash-swaps",title:"Flash Swaps",description:"Uniswap flash swaps\xa0allow you to withdraw up to the full reserves of any ERC20 token on Uniswap and execute arbitrary logic at no upfront cost, provided that by the end of the transaction you either:",source:"@site/docs/contracts/v2/concepts/02-core-concepts/03-flash-swaps.md",sourceDirName:"contracts/v2/concepts/02-core-concepts",slug:"/contracts/v2/concepts/core-concepts/flash-swaps",permalink:"/docs/contracts/v2/concepts/core-concepts/flash-swaps",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/contracts/v2/concepts/02-core-concepts/03-flash-swaps.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"flash-swaps",title:"Flash Swaps"},sidebar:"contractsSidebar",previous:{title:"Pools",permalink:"/docs/contracts/v2/concepts/core-concepts/pools"},next:{title:"Oracles",permalink:"/docs/contracts/v2/concepts/core-concepts/oracles"}},l={},c=[{value:"Capital Free Arbitrage",id:"capital-free-arbitrage",level:2},{value:"Withdrawing ETH from Uniswap",id:"withdrawing-eth-from-uniswap",level:3},{value:"Trade at External Venue",id:"trade-at-external-venue",level:3},{value:"Instant Leverage",id:"instant-leverage",level:2}],p={toc:c};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Uniswap flash swaps\xa0allow you to withdraw up to the full reserves of any ERC20 token on Uniswap and execute arbitrary logic at no upfront cost, provided that by the end of the transaction you either:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pay for the withdrawn ERC20 tokens with the corresponding pair tokens"),(0,r.kt)("li",{parentName:"ul"},"return the withdrawn ERC20 tokens along with a small fee")),(0,r.kt)("p",null,"Flash swaps are incredibly useful because they obviate upfront capital requirements and unnecessary order-of-operations constraints\xa0for multi-step transactions involving Uniswap."),(0,r.kt)("h1",{id:"examples"},"Examples"),(0,r.kt)("h2",{id:"capital-free-arbitrage"},"Capital Free Arbitrage"),(0,r.kt)("p",null,"One particularly interesting use case for flash swaps is capital-free\xa0arbitrage. It's well-known that an integral part of Uniswap's design is to create incentives for arbitrageurs to trade the Uniswap price to a \"fair\" market price. While game-theoretically sound, this strategy is accessible only to those with sufficient capital to take advantage of arbitrage opportunities. Flash swaps remove this barrier entirely, effectively democratizing arbitrage."),(0,r.kt)("p",null,"Imagine a scenario where the cost of buying 1 ETH on Uniswap is 200 DAI (which is calculated by calling ",(0,r.kt)("inlineCode",{parentName:"p"},"getAmountIn")," with 1 ETH specified as an exact output), and on Oasis (or any other trading venue), 1 ETH buys 220 DAI. To anyone with 200 DAI available, this situation represents a risk-free profit of 20 DAI. Unfortunately, you may not have 200 DAI lying around. With flash swaps, however, this risk-free profit is available for anyone to take as long as they're able to pay gas fees."),(0,r.kt)("h3",{id:"withdrawing-eth-from-uniswap"},"Withdrawing ETH from Uniswap"),(0,r.kt)("p",null,"The first step is to ",(0,r.kt)("em",{parentName:"p"},"optimistically")," withdraw 1 ETH from Uniswap via a flash swap. This will serve as the capital that we use to execute our arbitrage. Note that in this scenario, we're assuming that:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1 ETH is the pre-calculated profit-maximizing trade"),(0,r.kt)("li",{parentName:"ul"},"The price has not changed on Uniswap or Oasis since our calculation")),(0,r.kt)("p",null,"It may be the case that we'd like to calculate the profit-maximizing trade on-chain at the moment of execution, which is robust to price movements. This can be somewhat complex, depending on the strategy being executed. However, one common strategy is trading as profitably as possible ",(0,r.kt)("em",{parentName:"p"},"against a fixed external price"),". (This price may be e.g., the average execution price of one or more orders on Oasis.) If the Uniswap market price is far enough above or below this external price, the following example contains code that calculates the amount to trade over Uniswap for maximum profit: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/uniswap-v2-periphery/blob/master/contracts/examples/ExampleSwapToPrice.sol"},(0,r.kt)("inlineCode",{parentName:"a"},"ExampleSwapToPrice.sol")),"."),(0,r.kt)("h3",{id:"trade-at-external-venue"},"Trade at External Venue"),(0,r.kt)("p",null,"Once we've obtained our temporary capital of 1 ETH from Uniswap, we now can trade this for 220 DAI on Oasis. Once we've received the DAI, we need to pay Uniswap back. We've mentioned that the amount required to cover 1 ETH is 200 DAI, calculated via ",(0,r.kt)("inlineCode",{parentName:"p"},"getAmountIn"),". So, after sending 200 of the DAI back to the Uniswap pair, you're left with 20 DAI of profit!"),(0,r.kt)("h2",{id:"instant-leverage"},"Instant Leverage"),(0,r.kt)("p",null,"Flash swaps can be used to improve the efficiency of levering up using lending protocols and Uniswap."),(0,r.kt)("p",null,"Consider Maker in its simplest form: a system which accepts ETH as collateral and allows DAI to be minted against it while ensuring that the value of the ETH never drops below 150% of the value of the DAI."),(0,r.kt)("p",null,"Say we use this system to deposit a principal amount of 3 ETH, and mint the maximum amount of DAI. At a price of 1 ETH / 200 DAI, we receive 400 DAI. In theory, we could lever this position up by selling the DAI for more ETH, depositing this ETH, minting the maximum amount of DAI (which would be less this time), and repeating until we've reached our desired leverage level."),(0,r.kt)("p",null,"It's quite simple to use Uniswap as a liquidity source for the DAI-to-ETH component of this process. However, looping through protocols in this way isn't particularly elegant, and can be gas-intensive."),(0,r.kt)("p",null,"Luckily, flash swaps enable us to withdraw the ",(0,r.kt)("em",{parentName:"p"},"full")," ETH amount upfront. If we wanted 2x leverage against our 3 ETH principal, we could simply request 3 ETH in a flash swap and deposit 6 ETH into Maker. This gives us the ability to mint 800 DAI. If we mint as much as we need to cover our flash swap (say 605), the remainder serves as a safety margin against price movements."),(0,r.kt)("h1",{id:"developer-resources"},"Developer resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To see how to integrate a flash swap in your smart contract read ",(0,r.kt)("a",{parentName:"li",href:"../../guides/smart-contract-integration/using-flash-swaps"},"Using Flash Swaps"),".")))}u.isMDXComponent=!0},3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>f});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(a),f=r,d=h["".concat(l,".").concat(f)]||h[f]||u[f]||o;return a?n.createElement(d,i(i({ref:t},p),{},{components:a})):n.createElement(d,i({ref:t},p))}));function f(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);