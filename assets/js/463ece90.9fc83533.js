"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[99471],{98297:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(83117),o=(n(67294),n(3905));const i={id:"local-development",title:"Local Development",position:2},r=void 0,s={unversionedId:"sdk/v3/guides/local-development",id:"sdk/v3/guides/local-development",title:"Local Development",description:"Introduction",source:"@site/docs/sdk/v3/guides/02-local-development.md",sourceDirName:"sdk/v3/guides",slug:"/sdk/v3/guides/local-development",permalink:"/docs/sdk/v3/guides/local-development",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/sdk/v3/guides/02-local-development.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{id:"local-development",title:"Local Development",position:2},sidebar:"sdkSidebar",previous:{title:"Background",permalink:"/docs/sdk/v3/guides/background"},next:{title:"Web3 Development Basics",permalink:"/docs/sdk/v3/guides/web3-development-basics"}},l={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Using Foundry and Anvil",id:"using-foundry-and-anvil",level:2},{value:"Using your Mainnet Fork",id:"using-your-mainnet-fork",level:2},{value:"Next Steps",id:"next-steps",level:2}],u={toc:p};function d(e){let{components:t,...i}=e;return(0,o.kt)("wrapper",(0,a.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Developing your dApps or smart contracts requires some tinkering to get a proper setup that is both a good simulation of how Mainnet will behave,\nbut also customizable enough to suit the needs of a development environment."),(0,o.kt)("p",null,"One very common approach is to create your own custom chain offline and develop on top of it.\nThe issue with this approach is that if you are integrating with protocols like Uniswap or others that are on Mainnet, it's\ndifficult to simulate on your local chain as the smart contracts from Mainnet are not there."),(0,o.kt)("p",null,"Another approach is to use a testnet like Ethereum Goerli. While most protocols (including Uniswap) have versions of their smart contracts\ndeployed on common testnets, there are certain behavioural differences. Not all pools that are on Mainnet are on Goerli for example.\nAlso, it's difficult to get enough testnet ETH to account for real testing. And without lots of testnet ETH it's even more difficult\nto swap to other coins on Uniswap, if that's what you need to do in your development environment."),(0,o.kt)("p",null,"This guide focuses on yet another approach to local development: Mainnet Forks."),(0,o.kt)("p",null,"A Mainnet Fork is a local chain that copies the state of Ethereum Mainnet at a given block number. It then gives you access to cheat codes\nlike wallets with thousands of ETH and RPC URLs that you can use as drop-in replacements of real Mainnet RPCs."),(0,o.kt)("p",null,"This approach combines the best of all other approaches. You have a local chain that you can manipulate to your liking\nand you have real deployments of all the protocols you need to test and develop your dApp or smart contracts."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This guide focuses on Ethereum Mainnet. But you can easily fork any other chain by simply replacing the RPC URL with\none of the network you want to use."))),(0,o.kt)("p",null,"For this guide, the following packages are used:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@uniswap/v3-sdk"},(0,o.kt)("inlineCode",{parentName:"a"},"@uniswap/v3-sdk"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@uniswap/sdk-core"},(0,o.kt)("inlineCode",{parentName:"a"},"@uniswap/sdk-core"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/ethers"},(0,o.kt)("inlineCode",{parentName:"a"},"ethers@5")))),(0,o.kt)("p",null,"Please note that we use ethers version 5, as this is still the most commonly used version of ethers.js.\nIf you use version 6, you will need to slightly change the syntax in the examples below."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Forking a chain requires archival data and trace calls. Infura and normal geth instances are by default not archival.\nYou can get a free archival RPC that you can use to follow this guide and fork Mainnet you can visit ",(0,o.kt)("a",{parentName:"p",href:"https://www.chainnodes.org/"},"Chainnodes"),"."))),(0,o.kt)("h2",{id:"using-foundry-and-anvil"},"Using Foundry and Anvil"),(0,o.kt)("p",null,"There are several developer tools to fork Mainnet.\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/foundry-rs/foundry/blob/master/anvil/README.md"},"Anvil")," by foundry is a newcomer that's fast and easy to setup.\nThis guide focuses on Anvil."),(0,o.kt)("p",null,"As a first step, follow the ",(0,o.kt)("a",{parentName:"p",href:"https://book.getfoundry.sh/getting-started/installation"},"installation guide")," in the foundry book."),(0,o.kt)("p",null,"Once you have done that, you will be able to fork Mainnet straight away. Run the below command in your terminal:"),(0,o.kt)("p",null,"Make sure that you:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Replace your API Key (get one by heading to ",(0,o.kt)("a",{parentName:"li",href:"https://app.chainnodes.org/"},"Chainnodes"),")"),(0,o.kt)("li",{parentName:"ul"},"Replace the block number with a recent one, check ",(0,o.kt)("a",{parentName:"li",href:"https://etherscan.io/"},"Etherscan")," for that"),(0,o.kt)("li",{parentName:"ul"},"If you fork a non-Ethereum Mainnet chain, check ",(0,o.kt)("a",{parentName:"li",href:"https://chainlist.org/"},"Chainlist")," for the correct chain id and replace both occurrences in the command below")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"anvil --fork-url https://mainnet.chainnodes.org/api_key --fork-block-number 17480237 --fork-chain-id 1 --chain-id 1\n")),(0,o.kt)("p",null,"Run ",(0,o.kt)("inlineCode",{parentName:"p"},"anvil --help")," to see all available options."),(0,o.kt)("p",null,"Once you have done that, you should see something like the below:"),(0,o.kt)("img",{src:n(31225).Z,alt:"anvil result after calling","box-shadow":"none"}),(0,o.kt)("p",null,"Your local fork of Mainnet is now running!"),(0,o.kt)("p",null,"And as you can see on the screenshot above, anvil prints a bunch of private keys that are loaded with 10k ETH each.\nWe will use them going forward to send transactions, including swaps on Uniswap pools."),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Security consideration: This is a fork of Mainnet and the same chain id is used. You have no replay protection to Ethereum Mainnet. So you need to 1: Never use the anvil private keys on a real chain or send funds to it\n(they are leaked everywhere) and 2: Not send any transactions to your local fork chain with accounts that you use on Ethereum Mainnet or other real chains."))),(0,o.kt)("p",null,"If you scroll down in your terminal, near the bottom of the anvil logs you will find your RPC URL.\nIf you haven't changed any configs, it should be ",(0,o.kt)("inlineCode",{parentName:"p"},"127.0.0.1:8545"),".\nThis is the RPC URL that you can now use as a drop-in replacement everywhere in your development environment, and interact with it\nas if it was real Ethereum Mainnet. You can use the http provider ",(0,o.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:8545")," as well as the Websocket provider ",(0,o.kt)("inlineCode",{parentName:"p"},"ws://127.0.0.1:8545"),"."),(0,o.kt)("p",null,"You can now make a sample RPC request to your http provider using ",(0,o.kt)("a",{parentName:"p",href:"https://www.postman.com/"},"Postman")," using the below:"),(0,o.kt)("p",null,"POST ",(0,o.kt)("inlineCode",{parentName:"p"},"http://127.0.0.1:8545")),(0,o.kt)("p",null,"Body:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n    "jsonrpc": "2.0",\n    "method": "eth_chainId",\n    "params": [],\n    "id": 1\n}\n')),(0,o.kt)("p",null,"The result should look like the below (see image below as well):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n    "jsonrpc": "2.0",\n    "id": 1,\n    "result": "0x1"\n}\n')),(0,o.kt)("img",{src:n(20547).Z,alt:"anvil result after calling","box-shadow":"none"}),(0,o.kt)("p",null,"As you can see, the chain id is ",(0,o.kt)("inlineCode",{parentName:"p"},"1"),", just like on Mainnet!"),(0,o.kt)("p",null,"You can find the above example and more in ",(0,o.kt)("a",{parentName:"p",href:"https://www.postman.com/chainnodes/workspace/uniswap-examples"},"this Postman workspace"),' under "Local Development".'),(0,o.kt)("h2",{id:"using-your-mainnet-fork"},"Using your Mainnet Fork"),(0,o.kt)("p",null,"Now that you have a running Mainnet Fork, you will be able to use it everywhere in your development setup.\nUsing one of the private keys provided by anvil, you have access to enough ETH to do endless swaps and smart contract calls."),(0,o.kt)("p",null,"If you need any other token, you now have the flexibility of swapping your ETH to any token that has a pool deployed on Mainnet.\nYou basically take your fake ETH and swap it to the token you need."),(0,o.kt)("p",null,"Check out one of the ",(0,o.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/swaps/trading"},"guides about swapping")," and replace the RPC URL with your local anvil HTTP link as above."),(0,o.kt)("h2",{id:"next-steps"},"Next Steps"),(0,o.kt)("p",null,"Using the above you are fully equipped to continue following the guides about how to use Uniswap while testing everything locally before\ngoing on Mainnet. You will also be able to reuse what you have learned when you develop your own protocols or dApps."),(0,o.kt)("p",null,"You can also continue tapping into other developer tools that make smart contract development easier like ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/foundry-rs/foundry/tree/master/forge"},"forge")," from foundry.\nTo read more about foundry and their developer tooling, visit their ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/foundry-rs/foundry"},"GitHub")," or the ",(0,o.kt)("a",{parentName:"p",href:"https://book.getfoundry.sh/"},"foundry book"),"."))}d.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),h=o,m=c["".concat(l,".").concat(h)]||c[h]||d[h]||i;return n?a.createElement(m,r(r({ref:t},u),{},{components:n})):a.createElement(m,r({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var p=2;p<i;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},31225:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/anvil-result-cbdb52a1c3172c2644331ae2e3bf7869.png"},20547:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/postman-chainid-result-6b21251b7d4659fd348e4e0ed4869e52.png"}}]);