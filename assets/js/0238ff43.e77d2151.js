"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[1730],{57606:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>l});var a=n(83117),i=(n(67294),n(3905));const o={id:"position-data",title:"Liquidity Positions"},s=void 0,r={unversionedId:"sdk/v3/guides/liquidity/position-data",id:"sdk/v3/guides/liquidity/position-data",title:"Liquidity Positions",description:"Introduction",source:"@site/docs/sdk/v3/guides/liquidity/01-position-data.md",sourceDirName:"sdk/v3/guides/liquidity",slug:"/sdk/v3/guides/liquidity/position-data",permalink:"/docs/sdk/v3/guides/liquidity/position-data",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/sdk/v3/guides/liquidity/01-position-data.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"position-data",title:"Liquidity Positions"},sidebar:"sdkSidebar",previous:{title:"Routing a Swap",permalink:"/docs/sdk/v3/guides/swaps/routing"},next:{title:"Minting a Position",permalink:"/docs/sdk/v3/guides/liquidity/minting"}},p={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Concentrated liquidity",id:"concentrated-liquidity",level:3},{value:"Ticks",id:"ticks",level:3},{value:"Liquidity Positions",id:"liquidity-positions",level:3},{value:"Position class",id:"position-class",level:2},{value:"NonfungiblePositionManager",id:"nonfungiblepositionmanager",level:2},{value:"Creating a Position",id:"creating-a-position",level:3},{value:"Decreasing and Increasing a Position",id:"decreasing-and-increasing-a-position",level:3},{value:"Collecting Fees",id:"collecting-fees",level:3},{value:"Next steps",id:"next-steps",level:2}],c={toc:l};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"This guide will introduce us to ",(0,i.kt)("strong",{parentName:"p"},"liquidity positions")," in Uniswap V3 and present the ",(0,i.kt)("inlineCode",{parentName:"p"},"v3-sdk")," classes and Contracts used to interact with the protocol.\nThe concepts and code snippets showcased here can be found across the ",(0,i.kt)("strong",{parentName:"p"},"Pooling Liquidity")," examples in the Uniswap code examples ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/examples"},"repository"),"."),(0,i.kt)("p",null,"In this guide, we will take a look at the ",(0,i.kt)("a",{parentName:"p",href:"/docs/sdk/v3/reference/classes/Position"},"Position")," and ",(0,i.kt)("a",{parentName:"p",href:"/docs/sdk/v3/reference/classes/NonfungiblePositionManager"},"NonfungiblePositionManager")," classes, as well as the ",(0,i.kt)("a",{parentName:"p",href:"/docs/contracts/v3/reference/periphery/NonfungiblePositionManager"},"NonfungiblePositionManager Contract"),"."),(0,i.kt)("p",null,"At the end of the guide, we should be familiar with the most important classes used to interact with liquidity positions.\nWe should also understand how to fetch positions from the ",(0,i.kt)("strong",{parentName:"p"},"NonfungiblePositionManager Contract"),"."),(0,i.kt)("p",null,"For this guide, the following Uniswap packages are used:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@uniswap/v3-sdk"},(0,i.kt)("inlineCode",{parentName:"a"},"@uniswap/v3-sdk"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@uniswap/sdk-core"},(0,i.kt)("inlineCode",{parentName:"a"},"@uniswap/sdk-core"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/@uniswap/v3-periphery"},(0,i.kt)("inlineCode",{parentName:"a"},"@uniswap/v3-periphery")))),(0,i.kt)("p",null,"The code mentioned in this guide can be found across the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/examples/blob/main/v3-sdk/minting-position/src"},"minting Position"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/examples/blob/main/v3-sdk/collecting-fees/src"},"collecting Fees"),", ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/examples/blob/d34a53412dbf905802da2249391788a225719bb8/v3-sdk/modifying-position/src"},"modifying positions")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/examples/blob/main/v3-sdk/swap-and-add-liquidity/src"},"swap and add liquidity")," examples."),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"To understand what Positions are, we need to understand some underlying concepts of the Uniswap protocol."),(0,i.kt)("p",null,"Consider checking out the ",(0,i.kt)("a",{parentName:"p",href:"../../../../concepts/protocol/concentrated-liquidity.md"},"Concepts section")," as well as the ",(0,i.kt)("a",{parentName:"p",href:"https://uniswapv3book.com/docs/introduction/uniswap-v3/"},"Uniswap Book"),"."),(0,i.kt)("h3",{id:"concentrated-liquidity"},"Concentrated liquidity"),(0,i.kt)("p",null,"Uniswap V3 Pools use concentrated liquidity to allow a denser concentration of liquidity at specific prices.\nCompared to the full range liquidity model Uniswap V2 uses, this allows traders to make larger trades with less price impact.\nLiquidity providers can choose a specific price range in which they want their liquidity to be used by trades."),(0,i.kt)("p",null,"To achieve this, Uniswap V3 Pools discriminate the price range with ",(0,i.kt)("strong",{parentName:"p"},"Ticks"),"."),(0,i.kt)("h3",{id:"ticks"},"Ticks"),(0,i.kt)("p",null,"Ticks are the boundaries between discrete price ranges.\nA change of 1 Tick always represents a price change of 0.01% from the current price.\nUniswap V3 Pools can have different ",(0,i.kt)("inlineCode",{parentName:"p"},"tickSpacings"),", a constant that describes which ticks can be used by the Pool.\nOnly ticks at indices that are divisible by the tickSpacing can be initialized.\nThis value is dependant on the fee of the Pool, Pools with higher fees have higher tickSpacing."),(0,i.kt)("p",null,"For example, a Pool with ",(0,i.kt)("strong",{parentName:"p"},"HIGH")," fee (1%) has a tickSpacing of 200, meaning the price difference between initializable Ticks is:"),(0,i.kt)("p",null,(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mn",{parentName:"mrow"},"1.000"),(0,i.kt)("msup",{parentName:"mrow"},(0,i.kt)("mn",{parentName:"msup"},"1"),(0,i.kt)("mn",{parentName:"msup"},"200")),(0,i.kt)("mo",{parentName:"mrow"},"="),(0,i.kt)("mn",{parentName:"mrow"},"1.0202")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"1.0001^{200} = 1.0202")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.8141em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"1.000"),(0,i.kt)("span",{parentName:"span",className:"mord"},(0,i.kt)("span",{parentName:"span",className:"mord"},"1"),(0,i.kt)("span",{parentName:"span",className:"msupsub"},(0,i.kt)("span",{parentName:"span",className:"vlist-t"},(0,i.kt)("span",{parentName:"span",className:"vlist-r"},(0,i.kt)("span",{parentName:"span",className:"vlist",style:{height:"0.8141em"}},(0,i.kt)("span",{parentName:"span",style:{top:"-3.063em",marginRight:"0.05em"}},(0,i.kt)("span",{parentName:"span",className:"pstrut",style:{height:"2.7em"}}),(0,i.kt)("span",{parentName:"span",className:"sizing reset-size6 size3 mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},(0,i.kt)("span",{parentName:"span",className:"mord mtight"},"200"))))))))),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.kt)("span",{parentName:"span",className:"mrel"},"="),(0,i.kt)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"1.0202")))))," or ",(0,i.kt)("span",{parentName:"p",className:"math math-inline"},(0,i.kt)("span",{parentName:"span",className:"katex"},(0,i.kt)("span",{parentName:"span",className:"katex-mathml"},(0,i.kt)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,i.kt)("semantics",{parentName:"math"},(0,i.kt)("mrow",{parentName:"semantics"},(0,i.kt)("mn",{parentName:"mrow"},"2.02")),(0,i.kt)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"2.02")))),(0,i.kt)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,i.kt)("span",{parentName:"span",className:"base"},(0,i.kt)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,i.kt)("span",{parentName:"span",className:"mord"},"2.02"))))),"%"),(0,i.kt)("h3",{id:"liquidity-positions"},"Liquidity Positions"),(0,i.kt)("p",null,"When someone provides liquidity to a Pool, they create a ",(0,i.kt)("strong",{parentName:"p"},"Liquidity Position"),".\nThis position is defined by the amount of liquidity provided and the start tick and the end tick, or price range, of the Position."),(0,i.kt)("p",null,"Because V3 Pools allow users to choose any price range in which they want to provide liquidity, it is possible to create positions that do not contain the current Price of the Pool.\nIn this case, the liquidity provider will pay only one type of Token into the Pool, creating a ",(0,i.kt)("strong",{parentName:"p"},"single side liquidity position"),"."),(0,i.kt)("p",null,"To learn more about how Ticks and Liquidity positions work, consider reading the ",(0,i.kt)("a",{parentName:"p",href:"https://uniswap.org/whitepaper-v3.pdf"},"whitepaper")," or the other resources mentioned above."),(0,i.kt)("p",null,"Now that we have a rough understanding of liquidity positions in Uniswap V3, let's look at the correspondent classes the SDK offers us."),(0,i.kt)("h2",{id:"position-class"},"Position class"),(0,i.kt)("p",null,"The ",(0,i.kt)("strong",{parentName:"p"},"sdk")," provides a ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-sdk/blob/main/src/entities/position.ts"},(0,i.kt)("inlineCode",{parentName:"a"},"Position"))," class used to create local representations of an onchain position.\nIt is used to create the calldata for onchain calls to mint or modify an onchain position."),(0,i.kt)("p",null,"There are four ways to construct a position."),(0,i.kt)("p",null,"Directly with the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-sdk/blob/08a7c05/src/entities/position.ts#L40"},"constructor"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Pool, Position } from '@uniswap/v3-sdk'\nimport JSBI from 'jsbi'\n\nconst pool = new Pool(...)\nconst tickLower: number = -100\nconst tickUpper: number = 200\nconst liquidity: JSBI = JSBI.BigInt('1000000000000000000')\n\nconst position = new Position({\n    pool,\n    liquidity,\n    tickLower,\n    tickUpper\n})\n")),(0,i.kt)("p",null,"Using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-sdk/blob/08a7c05/src/entities/position.ts#L312"},(0,i.kt)("inlineCode",{parentName:"a"},"fromAmounts()"))," function:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { BigIntish } from '@uniswap/sdk-core'\n\nconst pool = new Pool(...)\nconst tickLower: number = -100\nconst tickUpper: number = 200\nconst amount0: BigIntish = '1000000000000000000'\nconst amount1: BigIntish = JSBI.BigInt('1000000000000000000')\nconst useFullPrecision: boolean = true\n\nconst position = Position.fromAmounts({\n    pool, \n    tickLower, \n    tickUpper, \n    amount0, \n    amount1, \n    useFullPrecision\n})\n")),(0,i.kt)("p",null,"Or using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-sdk/blob/08a7c050cba00377843497030f502c05982b1c43/src/entities/position.ts#L354"},(0,i.kt)("inlineCode",{parentName:"a"},"fromAmount0()"))," or ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-sdk/blob/08a7c050cba00377843497030f502c05982b1c43/src/entities/position.ts#L378"},(0,i.kt)("inlineCode",{parentName:"a"},"fromAmount1()"))," functions:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { BigIntish } from '@uniswap/sdk-core'\n...\n\nconst pool = new Pool(...)\nconst tickLower: number = -200\nconst tickUpper: number = 100\nconst amount0: BigIntish = '1000000000000000000'\nconst useFullPrecision: boolean = true\n\nconst singleSidePositionToken0 = Position.fromAmount0({\n    pool, \n    tickLower, \n    tickUpper, \n    amount0,\n    useFullPrecision\n})\n\nconst amount1: BigIntish = 100000000\n\nconst singleSidePositionToken1 = Position.fromAmount1({\n    pool, \n    tickLower, \n    tickUpper, \n    amount1,\n    useFullPrecision\n})\n")),(0,i.kt)("p",null,"These last two functions calculate a position at the given tick range given the amount of ",(0,i.kt)("inlineCode",{parentName:"p"},"token0")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"token1"),". The amount of the second token is calculated from the ratio of the tokens inside the tick range and the amount of token one."),(0,i.kt)("p",null,"A create transaction would then fail if the wallet doesn't hold enough ",(0,i.kt)("inlineCode",{parentName:"p"},"token1")," or the Contract is not given the necessary ",(0,i.kt)("strong",{parentName:"p"},"Transfer Approval"),"."),(0,i.kt)("p",null,"All of these functions take an Object with ",(0,i.kt)("strong",{parentName:"p"},"named values")," as a call parameter. The amount and liquidity values are of type ",(0,i.kt)("inlineCode",{parentName:"p"},"BigIntish")," which accepts ",(0,i.kt)("inlineCode",{parentName:"p"},"number"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"string")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"JSBI"),"."),(0,i.kt)("p",null,"The values of ",(0,i.kt)("inlineCode",{parentName:"p"},"tickLower")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"tickUpper")," must match ",(0,i.kt)("strong",{parentName:"p"},"initializable ticks")," of the Pool."),(0,i.kt)("h2",{id:"nonfungiblepositionmanager"},"NonfungiblePositionManager"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"NonfungiblePositionManager")," class is mainly used to create calldata for functions on the ",(0,i.kt)("strong",{parentName:"p"},"NonfungiblePositionManager Contract"),"."),(0,i.kt)("p",null,"We will look at the ",(0,i.kt)("strong",{parentName:"p"},"sdk")," class and write functions on the Contract in this section."),(0,i.kt)("h3",{id:"creating-a-position"},"Creating a Position"),(0,i.kt)("p",null,"To create a position on a Pool, the ",(0,i.kt)("a",{parentName:"p",href:"/docs/contracts/v3/reference/periphery/NonfungiblePositionManager#mint"},(0,i.kt)("inlineCode",{parentName:"a"},"mint"))," function is called on the Contract.\nThe ",(0,i.kt)("strong",{parentName:"p"},"sdk")," class provides the ",(0,i.kt)("inlineCode",{parentName:"p"},"addCallParameters")," function to create the calldata for the transaction:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"import { MintOptions, NonfungiblePositionManager } from '@uniswap/v3-sdk'\n\nconst mintOptions: MintOptions = {\n  recipient: address,\n  deadline: Math.floor(Date.now() / 1000) + 60 * 20,\n  slippageTolerance: new Percent(50, 10_000),\n}\n\n// get calldata for minting a position\nconst { calldata, value } = NonfungiblePositionManager.addCallParameters(\n  positionToMint,\n  mintOptions\n)\n")),(0,i.kt)("p",null,"This call creates a position if it doesn't exist, but can also be used to increase an existing position.\nTake a look at the ",(0,i.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/liquidity/minting"},"Mint Position guide")," and ",(0,i.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/liquidity/modifying-position"},"Modify Position guide")," to learn more."),(0,i.kt)("h3",{id:"decreasing-and-increasing-a-position"},"Decreasing and Increasing a Position"),(0,i.kt)("p",null,"To decrease or increase the liquidity of a Position, the ",(0,i.kt)("inlineCode",{parentName:"p"},"decreaseLiquidity")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"increaseLiquidity")," functions are called on the Contract.\nTo increase, ",(0,i.kt)("inlineCode",{parentName:"p"},"addCallParameters")," is used as mentioned above, to decrease we use ",(0,i.kt)("inlineCode",{parentName:"p"},"removeCallParameters"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const { calldata, value } = NonfungiblePositionManager.removeCallParameters(\n  currentPosition,\n  removeLiquidityOptions\n)\n")),(0,i.kt)("p",null,"Take a look at the ",(0,i.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/liquidity/modifying-position"},"Modify Positions guide")," to learn how to create the ",(0,i.kt)("inlineCode",{parentName:"p"},"currentPosition")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"removeLiquidityOptions")," parameters."),(0,i.kt)("h3",{id:"collecting-fees"},"Collecting Fees"),(0,i.kt)("p",null,"To collect fees accrued, the ",(0,i.kt)("inlineCode",{parentName:"p"},"collect")," function is called on the Contract.\nThe ",(0,i.kt)("strong",{parentName:"p"},"sdk class")," provides the ",(0,i.kt)("inlineCode",{parentName:"p"},"collectCallParameters")," function to create the calldata for that:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const { calldata, value } =\n  NonfungiblePositionManager.collectCallParameters(collectOptions)\n")),(0,i.kt)("h2",{id:"next-steps"},"Next steps"),(0,i.kt)("p",null,"Now that you are familiar with the most important classes and Contract to interact with Liquidity Positions, continue with the next guide on ",(0,i.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/liquidity/minting"},"Minting Positions"),"."))}d.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>u});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),m=l(n),u=i,k=m["".concat(p,".").concat(u)]||m[u]||d[u]||o;return n?a.createElement(k,s(s({ref:t},c),{},{components:n})):a.createElement(k,s({ref:t},c))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,s=new Array(o);s[0]=m;var r={};for(var p in t)hasOwnProperty.call(t,p)&&(r[p]=t[p]);r.originalType=e,r.mdxType="string"==typeof e?e:i,s[1]=r;for(var l=2;l<o;l++)s[l]=n[l];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);