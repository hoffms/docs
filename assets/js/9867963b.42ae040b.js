"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[89515],{52278:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var i=n(83117),a=(n(67294),n(3905));const o={id:"introduction",title:"Introduction"},r=void 0,s={unversionedId:"sdk/v3/guides/advanced/introduction",id:"sdk/v3/guides/advanced/introduction",title:"Introduction",description:"For some more advanced use cases, it is necessary to use multiple tools in the Uniswap toolchain.",source:"@site/docs/sdk/v3/guides/advanced/01-introduction.md",sourceDirName:"sdk/v3/guides/advanced",slug:"/sdk/v3/guides/advanced/introduction",permalink:"/docs/sdk/v3/guides/advanced/introduction",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/sdk/v3/guides/advanced/01-introduction.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"introduction",title:"Introduction"},sidebar:"sdkSidebar",previous:{title:"Swapping and Adding Liquidity",permalink:"/docs/sdk/v3/guides/liquidity/swap-and-add"},next:{title:"Fetching Pool Data",permalink:"/docs/sdk/v3/guides/advanced/pool-data"}},l={},p=[{value:"Theoretical background",id:"theoretical-background",level:2},{value:"Datatypes in Solidity",id:"datatypes-in-solidity",level:3},{value:"History of Uniswap",id:"history-of-uniswap",level:2}],d={toc:p};function c(e){let{components:t,...o}=e;return(0,a.kt)("wrapper",(0,i.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"For some more advanced use cases, it is necessary to use multiple tools in the Uniswap toolchain."),(0,a.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"If you need a briefer on the SDK and to learn more about how these guides connect to the examples repository, please visit our ",(0,a.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/background"},"background")," page!"))),(0,a.kt)("p",null,"The following examples use ",(0,a.kt)("strong",{parentName:"p"},"ethersJS")," and the ",(0,a.kt)("strong",{parentName:"p"},"Uniswap V3 subgraph")," hosted on The Graph's hosted service. To learn more about Uniswap's subgraphs, visit the ",(0,a.kt)("a",{parentName:"p",href:"../../../../api/subgraph/overview.md"},"API")," section."),(0,a.kt)("p",null,"We will take a deep dive into the Uniswap V3 protocol and use practical examples to understand the data stored by the Uniswap smart contracts.\nWe will explore how we can compute the available liquidity in a specific price range, visualize ",(0,a.kt)("strong",{parentName:"p"},"liquidity density")," in pools, use Uniswap as a ",(0,a.kt)("strong",{parentName:"p"},"price oracle")," and swap by creating ",(0,a.kt)("strong",{parentName:"p"},"Range Orders"),"."),(0,a.kt)("p",null,"These guides are a bit longer than the previous ones and provide more theoretical background."),(0,a.kt)("h2",{id:"theoretical-background"},"Theoretical background"),(0,a.kt)("p",null,"Some of the guides presented here require a bit of theoretical and mathematical background.\nTo get the most out of the advanced guides, we encourage you to take a step back and read a bit about the math and theories behind the Uniswap protocol."),(0,a.kt)("p",null,"The most complete source of information on the Uniswap protocol is the ",(0,a.kt)("a",{parentName:"p",href:"https://uniswapv3book.com/"},"Uniswap V3 book"),"."),(0,a.kt)("p",null,"Besides the ",(0,a.kt)("a",{parentName:"p",href:"../../../../concepts/uniswap-protocol.md"},"concepts")," section of the Docs, the ",(0,a.kt)("a",{parentName:"p",href:"https://uniswap.org/whitepaper-v3.pdf"},"Uniswap V3 whitepaper")," is a great introduction to the protocol.\nIf you haven't checked it out yet, it is probably more concise and easier to understand than you would expect."),(0,a.kt)("h3",{id:"datatypes-in-solidity"},"Datatypes in Solidity"),(0,a.kt)("p",null,"Uniswap V3 pools make use of a number of Datatypes Solidity offers to efficiently store their state.\nIf you are not familiar with Solidity data types yet, it can help to take a look at the ",(0,a.kt)("a",{parentName:"p",href:"https://docs.soliditylang.org/en/v0.8.7/types.html#"},"Solidity language reference"),".\nFor the following guides, it is beneficial to take a look at two of them, which  we will outline here."),(0,a.kt)("p",null,"Ticks are stored as a ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-core/blob/main/contracts/UniswapV3Pool.sol#L93"},"mapping(int24 => Tick.Info)"),".\nSolidity ",(0,a.kt)("a",{parentName:"p",href:"https://docs.soliditylang.org/en/v0.8.7/types.html#mapping-types"},"mappings")," are very similar to hash maps, such that we can access any Value with their key with just one read operation.\nThe ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-core/blob/main/contracts/libraries/Tick.sol#L17"},(0,a.kt)("inlineCode",{parentName:"a"},"Tick.Info"))," stores the values of the Tick that we need to work with the Pool:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-solidity"},"struct Info {\n        // the total position liquidity that references this tick\n        uint128 liquidityGross;\n        // amount of net liquidity added (subtracted) when tick is crossed from left to right (right to left),\n        int128 liquidityNet;\n        // fee growth per unit of liquidity on the _other_ side of this tick (relative to the current tick)\n        // only has relative meaning, not absolute \u2014 the value depends on when the tick is initialized\n        uint256 feeGrowthOutside0X128;\n        uint256 feeGrowthOutside1X128;\n        // the cumulative tick value on the other side of the tick\n        int56 tickCumulativeOutside;\n        // the seconds per unit of liquidity on the _other_ side of this tick (relative to the current tick)\n        // only has relative meaning, not absolute \u2014 the value depends on when the tick is initialized\n        uint160 secondsPerLiquidityOutsideX128;\n        // the seconds spent on the other side of the tick (relative to the current tick)\n        // only has relative meaning, not absolute \u2014 the value depends on when the tick is initialized\n        uint32 secondsOutside;\n        // true iff the tick is initialized, i.e. the value is exactly equivalent to the expression liquidityGross != 0\n        // these 8 bits are set to prevent fresh sstores when crossing newly initialized ticks\n        bool initialized;\n    }\n")),(0,a.kt)("p",null,"We will use most of these values in the following guides."),(0,a.kt)("p",null,"In our case, we can access any ",(0,a.kt)("inlineCode",{parentName:"p"},"Tick.Info")," value stored in the pool by its ",(0,a.kt)("inlineCode",{parentName:"p"},"int24")," key.\nThe key of the Tick is usually called its ",(0,a.kt)("em",{parentName:"p"},"index"),".\nMappings are not iterable, so if we are trying to fetch all the Ticks stored in a Pool, we can't just iterate over the mapping.\nInstead, we have to know the keys (indices) of the mapping, we will explore how to do that in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/sdk/v3/guides/advanced/pool-data"},"Pool data guide"),"."),(0,a.kt)("p",null,"The second Solidity datatype we need to understand are normal unsigned ",(0,a.kt)("a",{parentName:"p",href:"https://docs.soliditylang.org/en/v0.8.7/types.html#integers"},"Integers"),".\nSolidity supports unsigned integer sizes between ",(0,a.kt)("inlineCode",{parentName:"p"},"uint8")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"uint256"),", which are 8 and 256 bits long respectively."),(0,a.kt)("p",null,"Let's take a look at the ",(0,a.kt)("inlineCode",{parentName:"p"},"tickBitmap")," function of a V3 Pool:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-solidity"},"  function tickBitmap(\n      int16 wordPosition\n  ) external view returns (uint256)\n")),(0,a.kt)("p",null,"Similar to the tick mapping, the tickBitmap is a mapping of type ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Uniswap/v3-core/blob/main/contracts/UniswapV3Pool.sol#L95"},"mapping(int16 => uint256)"),"."),(0,a.kt)("p",null,"Let's look at the WETH/USDC pool with LOW fee on ",(0,a.kt)("a",{parentName:"p",href:"https://etherscan.io/address/0x88e6a0c2ddd26feeb64f039a2c41296fcb3f5640#readContract"},"Etherscan"),".\nIf we call the ",(0,a.kt)("inlineCode",{parentName:"p"},"tickBitmap")," function with the input ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," we get the following response (at the time of writing):"),(0,a.kt)("img",{src:n(46695).Z,alt:"TickBitmapEtherscan","box-shadow":"none"}),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"uint256")," return value is interpreted as the representation of a decimal number by Etherscan.\nThe actual raw return value are 256 bits, that look something like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-raw"},"0x0000 ... lots of zeros and ones ... 000000110000000000\n")),(0,a.kt)("p",null,"We interpret this string of zeros and ones not as the representation of a number, but rather as 256 booleans."),(0,a.kt)("p",null,"If the value of a position in the value is 1, the Tick at this position is ",(0,a.kt)("strong",{parentName:"p"},"initialized"),", meaning it holds a value."),(0,a.kt)("p",null,"With this trick, V3 Pools allow us to fetch the status of ",(0,a.kt)("strong",{parentName:"p"},"256 ticks")," with one call.\nWe will go into more details on how to calculate the tick indices from the tickBitmaps we fetch in the following guides."),(0,a.kt)("h2",{id:"history-of-uniswap"},"History of Uniswap"),(0,a.kt)("p",null,"To get a better understanding of the V3 protocol, it can also be beneficial to understand the ",(0,a.kt)("strong",{parentName:"p"},"history of decentralized exchanges")," and the Uniswap protocol since it was founded in 2018.\nYou can read more about the older versions of Uniswap in the ",(0,a.kt)("a",{parentName:"p",href:"https://hackmd.io/@HaydenAdams/HJ9jLsfTz?type=view#Swaps-vs-Transfers"},"V1")," and ",(0,a.kt)("a",{parentName:"p",href:"https://uniswap.org/whitepaper.pdf"},"V2")," whitepapers, as well as the ",(0,a.kt)("a",{parentName:"p",href:"/docs/contracts/v1/overview"},"V1")," and ",(0,a.kt)("a",{parentName:"p",href:"/docs/contracts/v2/overview"},"V2")," section in the contract section."))}c.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var i=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},u=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=p(n),h=a,m=u["".concat(l,".").concat(h)]||u[h]||c[h]||o;return n?i.createElement(m,r(r({ref:t},d),{},{components:n})):i.createElement(m,r({ref:t},d))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var p=2;p<o;p++)r[p]=n[p];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}u.displayName="MDXCreateElement"},46695:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/tickBitmap-etherscan-865c516ba55726c9ef7be35a433d4d9c.png"}}]);