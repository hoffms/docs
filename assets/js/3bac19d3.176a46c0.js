"use strict";(self.webpackChunk_uniswap_docs=self.webpackChunk_uniswap_docs||[]).push([[71212],{77195:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var a=t(83117),i=(t(67294),t(3905));const o={id:"crosschain",title:"Crosschain Operations",sidebar_position:5},r="Cross-Chain Operations",s={unversionedId:"concepts/protocol/crosschain",id:"concepts/protocol/crosschain",title:"Crosschain Operations",description:"Introduction",source:"@site/docs/concepts/protocol/crosschain.md",sourceDirName:"concepts/protocol",slug:"/concepts/protocol/crosschain",permalink:"/docs/concepts/protocol/crosschain",editUrl:"https://github.com/uniswap/uniswap-docs/tree/main/docs/concepts/protocol/crosschain.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{id:"crosschain",title:"Crosschain Operations",sidebar_position:5},sidebar:"conceptsSidebar",previous:{title:"Supported Chains",permalink:"/docs/concepts/protocol/chains"},next:{title:"Overview",permalink:"/docs/concepts/governance/overview"}},c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"Cross-Chain Message Costs",id:"cross-chain-message-costs",level:2},{value:"Verifying Cross-Chain Message Costs",id:"verifying-cross-chain-message-costs",level:2},{value:"How to create a cross-chain Trigger dApp",id:"how-to-create-a-cross-chain-trigger-dapp",level:2},{value:"BlockchainAction",id:"blockchainaction",level:3},{value:"TransferAction",id:"transferaction",level:3},{value:"Understanding BlockchainAction Execution",id:"understanding-blockchainaction-execution",level:2},{value:"Function Overview - sendMessage",id:"function-overview---sendmessage",level:3},{value:"Parameters Explanation",id:"parameters-explanation",level:3},{value:"Message Reception and Execution",id:"message-reception-and-execution",level:3},{value:"Key Operations",id:"key-operations",level:3},{value:"Important Considerations",id:"important-considerations",level:2}],d={toc:l};function u(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"cross-chain-operations"},"Cross-Chain Operations"),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"When you use Sherry Triggers to transfer assets across blockchains, you\u2019re leveraging the Wormhole protocol to enable seamless cross-chain operations. This integration facilitates direct communication between networks, overcoming the limitations of isolated chains and creating a more unified decentralized experience."),(0,i.kt)("p",null,"Cross-chain operations involve several moving parts: relaying messages between chains, estimating gas costs accurately, and handling pricing discrepancies. Triggers abstracts this complexity, providing developers and users with a simplified interface for interacting with multiple blockchains\u2014without needing to manage the underlying technical details."),(0,i.kt)("p",null,"In this guide, you\u2019ll learn the core concepts behind cross-chain transfers, how cost calculations work, and how to configure and execute operations effectively. Whether you\u2019re sending tokens, calling smart contract functions, or combining both actions, this knowledge will help you streamline your cross-chain workflows."),(0,i.kt)("h2",{id:"how-it-works"},"How it works"),(0,i.kt)("p",null,"When sending cross-chain messages with Triggers, there are two key cost-related aspects to keep in mind:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Gas Cost"),": Cross-chain transfers incur additional gas fees to facilitate interchain communication. When using Celo (or any supported destination chain), the transaction includes a higher gas cost than a standard transfer, due to the complexity of relaying messages and executing operations on another network."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Excess Gas Refund"),": After execution, any unused gas is refunded to the sender on the Avalanche chain. This ensures that you only pay for the resources your transaction actually consumes.")),(0,i.kt)("h2",{id:"cross-chain-message-costs"},"Cross-Chain Message Costs"),(0,i.kt)("p",null,"To estimate the cost of sending a message through Wormhole, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"quoteEVMDeliveryPric")," function provided by the Wormhole Relayer. This function requires the parameters:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Destination blockchain"),": The chain where the transaction will be executed."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Expected native cryptocurrency amount"),": If needed, specify the amount of native cryptocurrency the recipient will receive on the destination blockchain."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Gas limit"),": This parameter is crucial as it determines the maximum amount of gas that can be consumed during the transaction. Depending on the complexity of the function being executed, the gas limit may vary. Currently, we use values ranging from 100,000 to 800,000, and this must be specified by the creator of the Sherry Link.")),(0,i.kt)("h2",{id:"verifying-cross-chain-message-costs"},"Verifying Cross-Chain Message Costs"),(0,i.kt)("p",null,"If you want to verify the fee for sending a message via cross-chain sherry links for a cross-chain transfer, you can use the following function from our smart contract:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},"function quoteCrossChainCost(\n    uint16 _targetChain,\n    uint256 _receiverValue,\n    uint256 _gasLimit\n) public view returns (uint256 cost) {\n    (cost, ) = s_wormholeRelayer.quoteEVMDeliveryPrice(\n        _targetChain,\n        _receiverValue,\n        _gasLimit\n    );\n}\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Parameters:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_targetChain"),": The chain ID of the destination chain in Wormhole format (e.g., 14 for Celo)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_receiverValue"),": The amount in wei to be transferred to the recipient in the destination chain. This amount will be the amount the user will receive. If no native tokens are transferred, 0 will be set."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_gasLimit"),": An estimated gas limit for the transaction on the target chain.")),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"For a ",(0,i.kt)("strong",{parentName:"li"},"TransferAction")," corresponding to a transfer of native tokens from a blockchain to a source blockchain we send a ",(0,i.kt)("inlineCode",{parentName:"li"},"gas_limit")," of 100,000."),(0,i.kt)("li",{parentName:"ul"},"For ",(0,i.kt)("strong",{parentName:"li"},"Blockchain Actions"),", depending on the state of the network we send a maximum of 800,000.")))),(0,i.kt)("p",null,"This function interacts with the Wormhole Relayer to quote the cost of the cross-chain message delivery, helping you understand the exact fee before initiating the transfer. This is crucial for budgeting gas costs accurately in cross-chain operations facilitated by the Wormhole protocol."),(0,i.kt)("h2",{id:"how-to-create-a-cross-chain-trigger-dapp"},"How to create a cross-chain Trigger dApp"),(0,i.kt)("p",null,"The way to define a sherry link is very simple and is done through the metadata. In the chains property you must assign a different chain for source and destination, taking into account that this chain must be supported by Sherry."),(0,i.kt)("p",null,"A Trigger allows seamless operations across blockchains, simplifying both smart contract interactions and cryptocurrency transfers. Two main types of actions are supported: ",(0,i.kt)("strong",{parentName:"p"},"BlockchainAction")," and ",(0,i.kt)("strong",{parentName:"p"},"TransferAction"),"."),(0,i.kt)("h3",{id:"blockchainaction"},"BlockchainAction"),(0,i.kt)("p",null,"This type of action allows interaction with a smart contract on the target blockchain, executing a specific function defined in its ABI. Additionally, native cryptocurrency can be sent along with the function execution if the function is payable."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const actionMetadata: BlockchainActionMetadata = {\n  label: 'Cross-Chain Action',\n  address: '0x1234567890abcdef1234567890abcdef12345678',\n  abi: exampleAbi,\n  functionName: 'mint',\n  chains: { source: 'avalanche', destination: 'celo' },\n  amount: 0.01, // Optional: amount of native cryptocurrency to send\n};\n")),(0,i.kt)("p",null,"As you can see, celo has been defined as destination, this will be interpreted as cross-chain by Sherry (from Avalanche to Celo)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Parameters:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"label"),": Text displayed on the Sherry Link button."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"address"),": The smart contract's address on the target blockchain."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"abi"),": The ABI of the contract required to interact with its functions."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"functionName"),": The function in the contract to be executed (e.g., mint)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"chains"),": The blockchains where the action will take place (e.g., avalanche - celo)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"amount"),": (Optional) Amount of native cryptocurrency to send to the function. If specified, the function must be payable.")),(0,i.kt)("p",null,"Additionally, the ABI is validated to check if the mint function requires parameters. If so, the corresponding input fields are dynamically generated for the user."),(0,i.kt)("h3",{id:"transferaction"},"TransferAction"),(0,i.kt)("p",null,"This type of action is designed for transferring native cryptocurrency between addresses on specific blockchains. Both the recipient (",(0,i.kt)("inlineCode",{parentName:"p"},"to"),") and the amount (",(0,i.kt)("inlineCode",{parentName:"p"},"amount"),") are optional."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"const actions: TransferAction[] = [\n  {\n    label: '0.01 CELO',\n    to: '0x5b1869D9A4C187F2EAa108f3062412ecf0526b24',\n    amount: 0.01,\n    chains: { source: 'avalanche', destination: 'celo' },\n  },\n  {\n    label: 'Manual Transfer',\n    chains: { source: 'avalanche', destination: 'celo' },\n  },\n];\n")),(0,i.kt)("h2",{id:"understanding-blockchainaction-execution"},"Understanding BlockchainAction Execution"),(0,i.kt)("p",null,"When a BlockchainAction is executed in the context of a Trigger dApp, it triggers a series of operations designed to facilitate cross-chain communication and smart contract interactions. Below, we detail how the ",(0,i.kt)("inlineCode",{parentName:"p"},"sendMessage")," function works and how the data is handled throughout the process."),(0,i.kt)("h3",{id:"function-overview---sendmessage"},"Function Overview - sendMessage"),(0,i.kt)("p",null,"The core of the BlockchainAction lies in the ",(0,i.kt)("inlineCode",{parentName:"p"},"sendMessage")," function, which is responsible for encoding and sending the necessary information to execute a contract function on the target blockchain. The function signature is as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},'function sendMessage(\n    uint16 _targetChain,\n    address _receiverAddress,\n    address _contractToBeCalled,\n    bytes memory _encodedFunctionCall,\n    uint256 _gasLimit,\n    uint256 _receiverValue\n) external payable {\n    require(_gasLimit <= GAS_LIMIT, "Gas limit exceeds the maximum limit");\n\n    bytes memory encodedData = encodeMessage(\n        _contractToBeCalled,\n        _encodedFunctionCall\n    );\n\n    uint256 cost = quoteCrossChainCost(\n        _targetChain,\n        _receiverValue,\n        _gasLimit\n    );\n    require(msg.value >= cost, "Insufficient funds to send the message");\n\n    s_wormholeRelayer.sendPayloadToEvm{value: cost}(\n        _targetChain,\n        _receiverAddress,\n        encodedData,\n        _receiverValue,\n        _gasLimit,\n        ORIGIN_CHAIN,\n        msg.sender\n    );\n}\n')),(0,i.kt)("h3",{id:"parameters-explanation"},"Parameters Explanation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_targetChain"),": The chain to which the message will be sent."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_receiverAddress"),": The address of the smart contract that will handle the message on the target blockchain (SL1MessageReceiver)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_contractToBeCalled"),": The address of the contract function to be executed."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_encodedFunctionCall"),": The encoded data containing the function call and its parameters."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_gasLimit"),": The maximum gas limit for the transaction on the target chain."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"_receiverValue"),": The amount of native cryptocurrency to be sent along with the message.")),(0,i.kt)("p",null,"Upon invocation, the function first encodes the contract address and the function call using ",(0,i.kt)("inlineCode",{parentName:"p"},"encodeMessage"),". This encoding is crucial, as it transforms the data into a format that can be interpreted by the receiving contract."),(0,i.kt)("p",null,"Next, it calculates the cost associated with sending the message across chains using ",(0,i.kt)("inlineCode",{parentName:"p"},"quoteCrossChainCost"),", ensuring the sender has provided sufficient funds. If the conditions are met, it proceeds to call ",(0,i.kt)("inlineCode",{parentName:"p"},"s_wormholeRelayer.sendPayloadToEvm"),", sending the encoded data to the target chain."),(0,i.kt)("h3",{id:"message-reception-and-execution"},"Message Reception and Execution"),(0,i.kt)("p",null,"On the target blockchain, the receiving contract will execute the ",(0,i.kt)("inlineCode",{parentName:"p"},"receiveWormholeMessages")," function when a message is received. This function is designed to handle the incoming payload and trigger the appropriate contract function. Here's an outline of how it operates:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-solidity"},'function receiveWormholeMessages(\n    bytes memory payload,\n    bytes[] memory,\n    bytes32 sourceAddress,\n    uint16 sourceChain,\n    bytes32\n) public payable override isRegisteredSender(sourceChain, sourceAddress) {\n    require(\n        msg.sender == address(s_wormholeRelayer),\n        "Only the Wormhole Relayer can call this function"\n    );\n\n    s_payload = payload;\n\n    emit MessageInfoReceived(sourceAddress, payload);\n\n    (\n        address contractToBeCalled,\n        address sender,\n        bytes memory encodedFunctionCall\n    ) = abi.decode(payload, (address, address, bytes));\n\n    s_lastSender = sender;\n    s_lastEncodedFunctionCall = encodedFunctionCall;\n    s_lastContractToBeCalled = contractToBeCalled;\n    s_sourceAddress = sourceAddress;\n\n    (bool success, ) = contractToBeCalled.call{value: msg.value}(\n        encodedFunctionCall\n    );\n\n    if (!success) {\n        emit FunctionCallError("Error executing function call");\n    } else {\n        emit FunctionExecuted(contractToBeCalled, encodedFunctionCall);\n    }\n}\n')),(0,i.kt)("h3",{id:"key-operations"},"Key Operations"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The function checks if it was called by the Wormhole Relayer, ensuring only authorized entities can execute it."),(0,i.kt)("li",{parentName:"ol"},"It decodes the incoming payload to retrieve the original function call parameters."),(0,i.kt)("li",{parentName:"ol"},"The contract then uses ",(0,i.kt)("inlineCode",{parentName:"li"},"call")," to execute the specified function on the target contract, transferring any native cryptocurrency value that was included in the message.")),(0,i.kt)("h2",{id:"important-considerations"},"Important Considerations"),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("ul",{parentName:"div"},(0,i.kt)("li",{parentName:"ul"},"The ",(0,i.kt)("inlineCode",{parentName:"li"},"msg.sender")," during cross-chain operations will always refer to the Sherry Receiver Contract on the target blockchain. This is critical for ensuring that permissions and function calls are handled correctly."),(0,i.kt)("li",{parentName:"ul"},"Any functions utilizing ",(0,i.kt)("inlineCode",{parentName:"li"},"msg.sender")," will operate under the assumption that it refers to the Sherry Receiver, thus impacting access controls and function logic.\n:::")))))}u.isMDXComponent=!0},3905:(e,n,t)=>{t.d(n,{Zo:()=>d,kt:()=>p});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},d=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=l(t),p=i,m=h["".concat(c,".").concat(p)]||h[p]||u[p]||o;return t?a.createElement(m,r(r({ref:n},d),{},{components:t})):a.createElement(m,r({ref:n},d))}));function p(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=h;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var l=2;l<o;l++)r[l]=t[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"}}]);